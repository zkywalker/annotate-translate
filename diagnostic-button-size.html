<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æŒ‰é’®å¤§å°è¯Šæ–­å·¥å…·</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }
    .diagnostic-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      color: #1a73e8;
      margin-top: 0;
    }
    .step {
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-left: 4px solid #1a73e8;
    }
    .code-block {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      margin: 10px 0;
    }
    button {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #1557b0;
    }
    .result {
      background: #e8f5e9;
      border: 1px solid #4caf50;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .error {
      background: #ffebee;
      border: 1px solid #f44336;
    }
    .warning {
      background: #fff3e0;
      border: 1px solid #ff9800;
    }
  </style>
</head>
<body>
  <h1>ğŸ” èœå•æŒ‰é’®å¤§å° - è¯Šæ–­å·¥å…·</h1>

  <div class="diagnostic-section">
    <h2>æ­¥éª¤1ï¼šæ£€æŸ¥å½“å‰è®¾ç½®</h2>
    <button onclick="checkCurrentSetting()">æ£€æŸ¥ menuButtonSize è®¾ç½®</button>
    <div id="setting-result"></div>
  </div>

  <div class="diagnostic-section">
    <h2>æ­¥éª¤2ï¼šæ£€æŸ¥ CSS åŠ è½½</h2>
    <button onclick="checkCSSLoaded()">æ£€æŸ¥ content.css æ˜¯å¦åŠ è½½</button>
    <div id="css-result"></div>
  </div>

  <div class="diagnostic-section">
    <h2>æ­¥éª¤3ï¼šæµ‹è¯•æŒ‰é’®æ˜¾ç¤º</h2>
    <p>åœ¨ä¸‹é¢çš„æ–‡æœ¬æ¡†ä¸­é€‰æ‹©ä¸€äº›æ–‡å­—ï¼š</p>
    <div style="padding: 20px; background: white; border: 2px dashed #ccc; border-radius: 4px;">
      <p>This is a test paragraph. Please select some text here to trigger the menu buttons and check their size.</p>
      <p>è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡å­—ã€‚è¯·åœ¨è¿™é‡Œé€‰æ‹©ä¸€äº›æ–‡å­—æ¥è§¦å‘èœå•æŒ‰é’®ï¼Œå¹¶æ£€æŸ¥å®ƒä»¬çš„å¤§å°ã€‚</p>
    </div>
    <button onclick="inspectMenuButton()">æ£€æŸ¥èœå•æŒ‰é’®å±æ€§</button>
    <div id="inspect-result"></div>
  </div>

  <div class="diagnostic-section">
    <h2>æ­¥éª¤4ï¼šæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½</h2>
    <div class="step">
      <strong>å¦‚æœä¸Šé¢çš„æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</strong>
      <ol>
        <li>ç¡¬åˆ·æ–°é¡µé¢ï¼š<kbd>Ctrl+Shift+R</kbd> (Windows/Linux) æˆ– <kbd>Cmd+Shift+R</kbd> (Mac)</li>
        <li>é‡æ–°åŠ è½½æ‰©å±•ï¼šè®¿é—® <code>chrome://extensions/</code>ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®</li>
        <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</li>
      </ol>
    </div>
  </div>

  <div class="diagnostic-section">
    <h2>æ­¥éª¤5ï¼šæ‰‹åŠ¨è®¾ç½®æµ‹è¯•</h2>
    <button onclick="testSmall()">æµ‹è¯• Small</button>
    <button onclick="testMedium()">æµ‹è¯• Medium</button>
    <button onclick="testLarge()">æµ‹è¯• Large</button>
    <div id="test-result"></div>
  </div>

  <div class="diagnostic-section">
    <h2>æ§åˆ¶å°æ—¥å¿—</h2>
    <p>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (F12) æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</p>
    <div class="code-block">
      <div>æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š</div>
      <div>[Annotate-Translate] Menu button size: XXX</div>
      <div>[Annotate-Translate] Menu classes: XXX</div>
    </div>
  </div>

  <script>
    // æ£€æŸ¥å½“å‰è®¾ç½®
    function checkCurrentSetting() {
      const resultDiv = document.getElementById('setting-result');
      chrome.storage.sync.get(['menuButtonSize'], (result) => {
        const size = result.menuButtonSize || 'æœªè®¾ç½® (é»˜è®¤: small)';
        resultDiv.innerHTML = `
          <div class="result">
            <strong>âœ… å½“å‰è®¾ç½®å€¼ï¼š</strong> <code>${size}</code>
          </div>
        `;
        console.log('[è¯Šæ–­] menuButtonSize:', result.menuButtonSize);
      });
    }

    // æ£€æŸ¥ CSS æ˜¯å¦åŠ è½½
    function checkCSSLoaded() {
      const resultDiv = document.getElementById('css-result');
      const links = document.querySelectorAll('link[href*="content.css"], link[href*="content"]');
      const styles = document.querySelectorAll('style');
      
      let cssFound = false;
      let cssContent = '';
      
      // æ£€æŸ¥ <link> æ ‡ç­¾
      links.forEach(link => {
        console.log('[è¯Šæ–­] å‘ç° CSS link:', link.href);
        cssFound = true;
      });
      
      // æ£€æŸ¥å†…è”æ ·å¼
      styles.forEach(style => {
        if (style.textContent.includes('annotate-translate-menu')) {
          console.log('[è¯Šæ–­] å‘ç°å†…è”æ ·å¼åŒ…å« annotate-translate-menu');
          cssFound = true;
          cssContent = style.textContent;
        }
      });
      
      // æ£€æŸ¥æ˜¯å¦æœ‰ size-medium å’Œ size-large çš„å®šä¹‰
      const hasSize = cssContent.includes('size-medium') && cssContent.includes('size-large');
      
      if (cssFound) {
        resultDiv.innerHTML = `
          <div class="result ${!hasSize ? 'warning' : ''}">
            <strong>${hasSize ? 'âœ…' : 'âš ï¸'} CSS å·²åŠ è½½</strong><br>
            ${hasSize ? 
              'åŒ…å«å°ºå¯¸æ ·å¼å®šä¹‰ (size-medium, size-large)' : 
              'âš ï¸ æœªæ‰¾åˆ°å°ºå¯¸æ ·å¼å®šä¹‰ï¼Œå¯èƒ½éœ€è¦é‡æ–°åŠ è½½æ‰©å±•'
            }
          </div>
        `;
      } else {
        resultDiv.innerHTML = `
          <div class="result error">
            <strong>âŒ æœªæ‰¾åˆ° content.css</strong><br>
            æ‰©å±•çš„ CSS å¯èƒ½æœªæ­£ç¡®æ³¨å…¥
          </div>
        `;
      }
    }

    // æ£€æŸ¥èœå•æŒ‰é’®
    function inspectMenuButton() {
      const resultDiv = document.getElementById('inspect-result');
      const menu = document.getElementById('annotate-translate-menu');
      
      if (!menu) {
        resultDiv.innerHTML = `
          <div class="result warning">
            <strong>âš ï¸ æœªæ‰¾åˆ°èœå•æŒ‰é’®</strong><br>
            è¯·å…ˆé€‰æ‹©ä¸€äº›æ–‡å­—ä»¥æ˜¾ç¤ºèœå•æŒ‰é’®
          </div>
        `;
        return;
      }
      
      const button = menu.querySelector('.menu-button');
      const classes = menu.className;
      const computedStyle = button ? window.getComputedStyle(button) : null;
      
      resultDiv.innerHTML = `
        <div class="result">
          <strong>âœ… èœå•æŒ‰é’®ä¿¡æ¯ï¼š</strong><br>
          <strong>CSS ç±»ï¼š</strong> <code>${classes}</code><br>
          ${button ? `
            <strong>æŒ‰é’®é«˜åº¦ï¼š</strong> <code>${computedStyle.height}</code><br>
            <strong>æŒ‰é’®å®½åº¦ï¼š</strong> <code>${computedStyle.width}</code><br>
            <strong>å­—ä½“å¤§å°ï¼š</strong> <code>${computedStyle.fontSize}</code><br>
            <strong>å†…è¾¹è·ï¼š</strong> <code>${computedStyle.padding}</code><br>
          ` : ''}
        </div>
      `;
      
      console.log('[è¯Šæ–­] èœå•å…ƒç´ :', menu);
      console.log('[è¯Šæ–­] æŒ‰é’®å…ƒç´ :', button);
      console.log('[è¯Šæ–­] è®¡ç®—æ ·å¼:', computedStyle);
    }

    // æµ‹è¯•ä¸åŒå°ºå¯¸
    function testSmall() {
      testSize('small', 'Small (20x20px)');
    }

    function testMedium() {
      testSize('medium', 'Medium (24x24px)');
    }

    function testLarge() {
      testSize('large', 'Large (28x28px)');
    }

    function testSize(size, label) {
      const resultDiv = document.getElementById('test-result');
      chrome.storage.sync.set({ menuButtonSize: size }, () => {
        resultDiv.innerHTML = `
          <div class="result">
            <strong>âœ… å·²è®¾ç½®ä¸ºï¼š</strong> ${label}<br>
            è¯·åˆ·æ–°é¡µé¢ (F5) å¹¶é€‰æ‹©æ–‡å­—æŸ¥çœ‹æ•ˆæœ
          </div>
        `;
        console.log('[è¯Šæ–­] è®¾ç½® menuButtonSize ä¸º:', size);
      });
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.addEventListener('load', () => {
      console.log('[è¯Šæ–­å·¥å…·] é¡µé¢å·²åŠ è½½');
      checkCurrentSetting();
      checkCSSLoaded();
    });
  </script>
</body>
</html>
