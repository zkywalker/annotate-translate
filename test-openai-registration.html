<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI Provider Registration Test</title>
</head>
<body>
    <h1>OpenAI Provider Registration Test</h1>
    <div id="results"></div>

    <script src="ai-providers/prompt-templates.js"></script>
    <script src="ai-providers/base-ai-provider.js"></script>
    <script src="ai-providers/openai-provider.js"></script>
    <script src="translation-service.js"></script>

    <script>
        const results = document.getElementById('results');
        
        function log(message, isError = false) {
            const p = document.createElement('p');
            p.textContent = message;
            p.style.color = isError ? 'red' : 'green';
            results.appendChild(p);
            console.log(message);
        }

        // Test 1: Check if classes are loaded
        log('=== Test 1: Check Classes ===');
        log(`PromptTemplates: ${typeof PromptTemplates !== 'undefined' ? '✅' : '❌'}`);
        log(`BaseAIProvider: ${typeof BaseAIProvider !== 'undefined' ? '✅' : '❌'}`);
        log(`OpenAIProvider: ${typeof OpenAIProvider !== 'undefined' ? '✅' : '❌'}`);
        log(`TranslationProvider: ${typeof TranslationProvider !== 'undefined' ? '✅' : '❌'}`);
        log(`OpenAITranslateProvider: ${typeof OpenAITranslateProvider !== 'undefined' ? '✅' : '❌'}`);
        log(`translationService: ${typeof translationService !== 'undefined' ? '✅' : '❌'}`);

        // Test 2: Check registered providers
        log('\n=== Test 2: Registered Providers ===');
        if (typeof translationService !== 'undefined') {
            log(`Total providers: ${translationService.providers.size}`);
            translationService.providers.forEach((provider, name) => {
                log(`  - ${name}: ${provider.constructor.name}`);
            });
        }

        // Test 3: Check if openai is registered
        log('\n=== Test 3: OpenAI Provider Check ===');
        if (typeof translationService !== 'undefined') {
            const hasOpenAI = translationService.providers.has('openai');
            log(`Has 'openai' provider: ${hasOpenAI ? '✅' : '❌'}`, !hasOpenAI);
            
            if (hasOpenAI) {
                const openaiProvider = translationService.providers.get('openai');
                log(`OpenAI provider type: ${openaiProvider.constructor.name}`);
                log(`OpenAI provider name: ${openaiProvider.name}`);
            }
        }

        // Test 4: Try to create OpenAITranslateProvider manually
        log('\n=== Test 4: Manual Creation Test ===');
        try {
            if (typeof OpenAITranslateProvider !== 'undefined') {
                const testProvider = new OpenAITranslateProvider({
                    apiKey: 'test-key',
                    model: 'gpt-3.5-turbo',
                    baseURL: 'https://api.openai.com/v1'
                });
                log(`✅ OpenAITranslateProvider created successfully`);
                log(`   - Name: ${testProvider.name}`);
                log(`   - Model: ${testProvider.model}`);
                log(`   - Is TranslationProvider: ${testProvider instanceof TranslationProvider}`);
            } else {
                log('❌ OpenAITranslateProvider class not found', true);
            }
        } catch (error) {
            log(`❌ Error creating OpenAITranslateProvider: ${error.message}`, true);
            console.error(error);
        }

        // Test 5: Check the registration code
        log('\n=== Test 5: Check Registration Code ===');
        log('Looking at line 1844 of translation-service.js...');
        log('Expected: translationService.registerProvider(\'openai\', new OpenAITranslateProvider());');
        
        // Test 6: Try to set active provider
        log('\n=== Test 6: Try Set Active Provider ===');
        if (typeof translationService !== 'undefined') {
            try {
                translationService.setActiveProvider('openai');
                log('✅ Successfully set active provider to openai');
                log(`Current active provider: ${translationService.getActiveProvider().name}`);
            } catch (error) {
                log(`❌ Error setting active provider: ${error.message}`, true);
                console.error(error);
            }
        }
    </script>
</body>
</html>
