# ç¿»è¯‘æœåŠ¡é›†æˆå¾…åŠäº‹é¡¹

## âœ… å·²å®Œæˆ

- [x] è®¾è®¡ç¿»è¯‘æœåŠ¡æŠ½è±¡å±‚æ¶æ„
- [x] å®ç° TranslationProvider æŠ½è±¡åŸºç±»
- [x] å®ç° GoogleTranslateProvider
- [x] å®ç° YoudaoTranslateProvider
- [x] å®ç° LocalDictionaryProvider
- [x] å®ç° TranslationService ç®¡ç†å™¨
- [x] å®ç° TranslationUI æ¸²æŸ“ç»„ä»¶
- [x] å®ç°éŸ³é¢‘æ’­æ”¾åŠŸèƒ½ï¼ˆTTS + åœ¨çº¿éŸ³é¢‘ï¼‰
- [x] è®¾è®¡æ ‡å‡†JSONæ•°æ®ç»“æ„
- [x] åˆ›å»ºCSSæ ·å¼ï¼ˆå“åº”å¼ + æ·±è‰²æ¨¡å¼ï¼‰
- [x] ç¼–å†™é›†æˆç¤ºä¾‹ä»£ç 
- [x] åˆ›å»ºæµè§ˆå™¨æµ‹è¯•é¡µé¢
- [x] ç¼–å†™å®Œæ•´æ–‡æ¡£

## ğŸ”„ è¿›è¡Œä¸­

### é˜¶æ®µ1: é›†æˆåˆ°ç°æœ‰ä»£ç  (é¢„è®¡1-2å°æ—¶)

- [ ] **æ›´æ–° manifest.json**
  - [ ] æ·»åŠ  `translation-service.js` åˆ° content_scripts
  - [ ] æ·»åŠ  `translation-ui.js` åˆ° content_scripts
  - [ ] æ·»åŠ  `translation-ui.css` åˆ° content_scripts
  - [ ] ç¡®ä¿è„šæœ¬åŠ è½½é¡ºåºæ­£ç¡®

- [ ] **ä¿®æ”¹ content.js**
  - [ ] æ›¿æ¢ `translateText()` å‡½æ•°å®ç°
  - [ ] æ·»åŠ åŠ è½½çŠ¶æ€æç¤º
  - [ ] æ·»åŠ é”™è¯¯å¤„ç†
  - [ ] ä¼˜åŒ–tooltipå®šä½é€»è¾‘
  - [ ] æ·»åŠ å…³é—­æŒ‰é’®
  - [ ] æµ‹è¯•ä¸ç°æœ‰æ ‡æ³¨åŠŸèƒ½çš„å…¼å®¹æ€§

- [ ] **ä¿®æ”¹ popup.js**
  - [ ] æ·»åŠ ç¿»è¯‘æä¾›å•†é€‰æ‹©ä¸‹æ‹‰æ¡†
  - [ ] æ·»åŠ éŸ³é¢‘å¼€å…³
  - [ ] æ·»åŠ UIæ˜¾ç¤ºé€‰é¡¹ï¼ˆè¯ä¹‰ã€ä¾‹å¥ç­‰ï¼‰
  - [ ] ä¿å­˜é…ç½®åˆ° chrome.storage

- [ ] **ä¿®æ”¹ popup.html**
  - [ ] æ·»åŠ æä¾›å•†é€‰æ‹©UI
  - [ ] æ·»åŠ éŸ³é¢‘è®¾ç½®UI
  - [ ] æ·»åŠ æ˜¾ç¤ºé€‰é¡¹UI
  - [ ] ä¼˜åŒ–å¸ƒå±€

- [ ] **æ›´æ–° content.css**
  - [ ] è°ƒæ•´ tooltip æ ·å¼ä»¥é€‚åº”æ–°UI
  - [ ] æ·»åŠ åŠ è½½åŠ¨ç”»æ ·å¼
  - [ ] ç¡®ä¿ä¸ translation-ui.css å…¼å®¹

### é˜¶æ®µ2: æµ‹è¯•ä¸ä¼˜åŒ– (é¢„è®¡1å°æ—¶)

- [ ] **åŠŸèƒ½æµ‹è¯•**
  - [ ] æµ‹è¯•åŸºç¡€ç¿»è¯‘åŠŸèƒ½
  - [ ] æµ‹è¯•ä¸‰ä¸ªæä¾›å•†åˆ‡æ¢
  - [ ] æµ‹è¯•éŸ³é¢‘æ’­æ”¾ï¼ˆTTS + åœ¨çº¿ï¼‰
  - [ ] æµ‹è¯•UIæ¸²æŸ“ï¼ˆå®Œæ•´ç‰ˆ + ç®€åŒ–ç‰ˆï¼‰
  - [ ] æµ‹è¯•ç¼“å­˜æœºåˆ¶
  - [ ] æµ‹è¯•é”™è¯¯å¤„ç†

- [ ] **å…¼å®¹æ€§æµ‹è¯•**
  - [ ] æµ‹è¯•ä¸æ ‡æ³¨åŠŸèƒ½çš„é…åˆ
  - [ ] æµ‹è¯•åœ¨ä¸åŒç½‘é¡µä¸Šçš„è¡¨ç°
  - [ ] æµ‹è¯•åœ¨ä¸åŒæµè§ˆå™¨ä¸Šçš„è¡¨ç°
  - [ ] æµ‹è¯•æ·±è‰²æ¨¡å¼
  - [ ] æµ‹è¯•å“åº”å¼å¸ƒå±€

- [ ] **æ€§èƒ½æµ‹è¯•**
  - [ ] æµ‹è¯•ç¿»è¯‘é€Ÿåº¦
  - [ ] æµ‹è¯•ç¼“å­˜å‘½ä¸­ç‡
  - [ ] æµ‹è¯•å†…å­˜å ç”¨
  - [ ] æµ‹è¯•éŸ³é¢‘åŠ è½½é€Ÿåº¦

- [ ] **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
  - [ ] ä¼˜åŒ–åŠ è½½åŠ¨ç”»
  - [ ] ä¼˜åŒ–é”™è¯¯æç¤º
  - [ ] ä¼˜åŒ–tooltipå®šä½ç®—æ³•
  - [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ
  - [ ] ä¼˜åŒ–è‡ªåŠ¨å…³é—­æ—¶æœº

### é˜¶æ®µ3: æ–‡æ¡£ä¸å‘å¸ƒ (é¢„è®¡30åˆ†é’Ÿ)

- [ ] **æ›´æ–°ä¸»README**
  - [ ] æ·»åŠ ç¿»è¯‘åŠŸèƒ½è¯´æ˜
  - [ ] æ›´æ–°åŠŸèƒ½åˆ—è¡¨
  - [ ] æ·»åŠ ä½¿ç”¨æˆªå›¾
  - [ ] æ›´æ–°å®‰è£…è¯´æ˜

- [ ] **åˆ›å»ºCHANGELOG**
  - [ ] è®°å½•æœ¬æ¬¡æ›´æ–°å†…å®¹
  - [ ] åˆ—å‡ºæ–°å¢åŠŸèƒ½
  - [ ] åˆ—å‡ºæ”¹è¿›é¡¹ç›®

- [ ] **å‡†å¤‡å‘å¸ƒ**
  - [ ] æ›´æ–°ç‰ˆæœ¬å·
  - [ ] æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶
  - [ ] æ‰“åŒ…æ‰©å±•
  - [ ] æµ‹è¯•æ‰“åŒ…åçš„æ‰©å±•

## ğŸ“‹ è¯¦ç»†æ­¥éª¤

### Step 1: æ›´æ–° manifest.json

```json
{
  "manifest_version": 3,
  "name": "Annotate Translate",
  "version": "2.0.0",
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": [
        "translation-service.js",
        "translation-ui.js",
        "content.js"
      ],
      "css": [
        "translation-ui.css",
        "content.css"
      ],
      "run_at": "document_end"
    }
  ]
}
```

### Step 2: ä¿®æ”¹ content.js

åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ åˆå§‹åŒ–ä»£ç ï¼š

```javascript
// åˆå§‹åŒ–ç¿»è¯‘æœåŠ¡é…ç½®
async function initTranslationService() {
  const config = await new Promise((resolve) => {
    chrome.storage.sync.get({
      translationProvider: 'google',
      enableAudio: true,
      showDefinitions: true,
      showExamples: true
    }, resolve);
  });
  
  translationService.setActiveProvider(config.translationProvider);
  window.translationUIConfig = config;
}

// åœ¨ init() å‡½æ•°ä¸­è°ƒç”¨
function init() {
  console.log('[Annotate-Translate] Content script loaded');
  loadSettings();
  initTranslationService();
  // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
}
```

æ›¿æ¢ `translateText()` å‡½æ•°ï¼š

```javascript
async function translateText(text) {
  console.log('[Annotate-Translate] Translating:', text);
  hideContextMenu();
  
  // ç§»é™¤æ—§tooltip
  const oldTooltip = document.querySelector('.annotate-translate-tooltip');
  if (oldTooltip) {
    oldTooltip.remove();
  }

  try {
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const loadingTooltip = createLoadingTooltip();
    document.body.appendChild(loadingTooltip);
    positionTooltip(loadingTooltip);

    // æ‰§è¡Œç¿»è¯‘
    const result = await translationService.translate(
      text,
      settings.targetLanguage || 'zh-CN',
      'auto'
    );

    // ç§»é™¤åŠ è½½tooltip
    loadingTooltip.remove();

    // åˆ›å»ºç¿»è¯‘ç»“æœUI
    const ui = new TranslationUI(window.translationUIConfig || {
      enableAudio: true,
      showDefinitions: true,
      showExamples: true,
      maxExamples: 2
    });

    // æ ¹æ®æ–‡æœ¬é•¿åº¦é€‰æ‹©UIæ¨¡å¼
    const resultElement = text.length > 50 
      ? ui.renderSimple(result)
      : ui.render(result);

    resultElement.classList.add('annotate-translate-tooltip');
    
    // æ·»åŠ å…³é—­æŒ‰é’®
    const closeButton = document.createElement('button');
    closeButton.className = 'translation-close-button';
    closeButton.innerHTML = 'âœ•';
    closeButton.title = 'Close';
    closeButton.addEventListener('click', () => {
      resultElement.remove();
      ui.cleanup();
    });
    resultElement.appendChild(closeButton);

    // æ˜¾ç¤º
    document.body.appendChild(resultElement);
    positionTooltip(resultElement);

    // è‡ªåŠ¨å…³é—­
    setTimeout(() => {
      if (resultElement.parentNode) {
        resultElement.remove();
        ui.cleanup();
      }
    }, 10000);

  } catch (error) {
    console.error('[Annotate-Translate] Translation error:', error);
    
    // æ˜¾ç¤ºé”™è¯¯æç¤º
    const errorTooltip = document.createElement('div');
    errorTooltip.className = 'annotate-translate-tooltip error';
    errorTooltip.textContent = 'Translation failed. Please try again.';
    document.body.appendChild(errorTooltip);
    positionTooltip(errorTooltip);
    
    setTimeout(() => errorTooltip.remove(), 3000);
  }
}

// è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºåŠ è½½tooltip
function createLoadingTooltip() {
  const tooltip = document.createElement('div');
  tooltip.className = 'annotate-translate-tooltip loading';
  tooltip.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px;">
      <div class="loading-spinner"></div>
      <div>Translating...</div>
    </div>
  `;
  return tooltip;
}

// è¾…åŠ©å‡½æ•°ï¼šå®šä½tooltip
function positionTooltip(tooltip) {
  const selection = window.getSelection();
  if (selection.rangeCount > 0) {
    const range = selection.getRangeAt(0);
    const rect = range.getBoundingClientRect();
    
    tooltip.style.position = 'absolute';
    tooltip.style.left = (rect.left + window.scrollX) + 'px';
    tooltip.style.top = (rect.bottom + window.scrollY + 10) + 'px';
    tooltip.style.zIndex = '10000';
    
    // ç¡®ä¿ä¸è¶…å‡ºè§†å£
    setTimeout(() => {
      const tooltipRect = tooltip.getBoundingClientRect();
      
      if (tooltipRect.right > window.innerWidth) {
        tooltip.style.left = (window.innerWidth - tooltipRect.width - 10) + 'px';
      }
      
      if (tooltipRect.bottom > window.innerHeight) {
        tooltip.style.top = (rect.top + window.scrollY - tooltipRect.height - 10) + 'px';
      }
    }, 0);
  }
}
```

### Step 3: ä¿®æ”¹ popup.html

åœ¨ `<div class="settings">` ä¸­æ·»åŠ æ–°è®¾ç½®ï¼š

```html
<!-- ç¿»è¯‘æä¾›å•†é€‰æ‹© -->
<div class="setting-item">
  <label for="translation-provider">Translation Provider:</label>
  <select id="translation-provider">
    <option value="google">Google Translate</option>
    <option value="youdao">Youdao</option>
    <option value="local">Local Dictionary</option>
  </select>
</div>

<!-- éŸ³é¢‘è®¾ç½® -->
<div class="setting-item">
  <label>
    <input type="checkbox" id="enable-audio" checked>
    Enable Audio Pronunciation
  </label>
</div>

<!-- æ˜¾ç¤ºé€‰é¡¹ -->
<div class="setting-item">
  <label>
    <input type="checkbox" id="show-definitions" checked>
    Show Definitions
  </label>
</div>

<div class="setting-item">
  <label>
    <input type="checkbox" id="show-examples" checked>
    Show Examples
  </label>
</div>
```

### Step 4: ä¿®æ”¹ popup.js

æ›´æ–°åŠ è½½å’Œä¿å­˜è®¾ç½®ï¼š

```javascript
function loadSettings() {
  chrome.storage.sync.get({
    enableTranslate: false,
    enableAnnotate: true,
    targetLanguage: 'en',
    translationProvider: 'google',
    enableAudio: true,
    showDefinitions: true,
    showExamples: true
  }, function(items) {
    document.getElementById('enable-translate').checked = items.enableTranslate;
    document.getElementById('enable-annotate').checked = items.enableAnnotate;
    document.getElementById('target-language').value = items.targetLanguage;
    document.getElementById('translation-provider').value = items.translationProvider;
    document.getElementById('enable-audio').checked = items.enableAudio;
    document.getElementById('show-definitions').checked = items.showDefinitions;
    document.getElementById('show-examples').checked = items.showExamples;
  });
}

function saveSettings() {
  const settings = {
    enableTranslate: document.getElementById('enable-translate').checked,
    enableAnnotate: document.getElementById('enable-annotate').checked,
    targetLanguage: document.getElementById('target-language').value,
    translationProvider: document.getElementById('translation-provider').value,
    enableAudio: document.getElementById('enable-audio').checked,
    showDefinitions: document.getElementById('show-definitions').checked,
    showExamples: document.getElementById('show-examples').checked
  };

  chrome.storage.sync.set(settings, function() {
    // æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
    const status = document.getElementById('status');
    status.textContent = 'Settings saved!';
    status.className = 'status success';
    
    // é€šçŸ¥content scriptæ›´æ–°è®¾ç½®
    chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
      if (tabs[0] && isValidTabUrl(tabs[0].url)) {
        chrome.tabs.sendMessage(tabs[0].id, {
          action: 'updateSettings',
          settings: settings
        });
      }
    });

    setTimeout(() => {
      status.textContent = '';
      status.className = 'status';
    }, 3000);
  });
}
```

### Step 5: æ›´æ–° content.css

æ·»åŠ æ–°æ ·å¼ï¼š

```css
/* åŠ è½½åŠ¨ç”» */
.loading-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(0, 0, 0, 0.1);
  border-top-color: #667eea;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* å…³é—­æŒ‰é’® */
.translation-close-button {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 24px;
  height: 24px;
  border: none;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  cursor: pointer;
  font-size: 14px;
  line-height: 1;
  transition: all 0.2s;
}

.translation-close-button:hover {
  background: rgba(0, 0, 0, 0.2);
  transform: scale(1.1);
}

/* é”™è¯¯çŠ¶æ€ */
.annotate-translate-tooltip.error {
  background: #f44336;
  color: white;
}

/* åŠ è½½çŠ¶æ€ */
.annotate-translate-tooltip.loading {
  background: white;
  padding: 12px 16px;
}
```

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] ç¿»è¯‘å•è¯ï¼ˆå¦‚ "apple"ï¼‰
- [ ] ç¿»è¯‘å¥å­ï¼ˆå¦‚ "Hello world"ï¼‰
- [ ] ç¿»è¯‘æ®µè½ï¼ˆå¤šè¡Œæ–‡æœ¬ï¼‰
- [ ] åˆ‡æ¢ç›®æ ‡è¯­è¨€
- [ ] åˆ‡æ¢æä¾›å•†ï¼ˆGoogle/Youdao/Localï¼‰

### UIæµ‹è¯•

- [ ] å®Œæ•´ç‰ˆUIæ˜¾ç¤ºæ­£ç¡®
- [ ] ç®€åŒ–ç‰ˆUIæ˜¾ç¤ºæ­£ç¡®
- [ ] è¯»éŸ³æŒ‰é’®å¯ç‚¹å‡»
- [ ] éŸ³é¢‘æ’­æ”¾æ­£å¸¸
- [ ] å…³é—­æŒ‰é’®å·¥ä½œæ­£å¸¸
- [ ] è‡ªåŠ¨å…³é—­åŠŸèƒ½æ­£å¸¸

### å…¼å®¹æ€§æµ‹è¯•

- [ ] ä¸æ ‡æ³¨åŠŸèƒ½ä¸å†²çª
- [ ] åœ¨ä¸åŒç½‘ç«™ä¸Šæ­£å¸¸å·¥ä½œ
- [ ] Chromeæµè§ˆå™¨æµ‹è¯•
- [ ] Edgeæµè§ˆå™¨æµ‹è¯•
- [ ] æ·±è‰²ç½‘é¡µä¸Šæ˜¾ç¤ºæ­£å¸¸
- [ ] æ˜äº®ç½‘é¡µä¸Šæ˜¾ç¤ºæ­£å¸¸

### é”™è¯¯å¤„ç†æµ‹è¯•

- [ ] æ— ç½‘ç»œæ—¶çš„è¡¨ç°
- [ ] APIé™æµæ—¶çš„è¡¨ç°
- [ ] ä¸æ”¯æŒçš„è¯­è¨€å¯¹
- [ ] è¶…é•¿æ–‡æœ¬å¤„ç†
- [ ] ç‰¹æ®Šå­—ç¬¦å¤„ç†

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

ç›®æ ‡å€¼ï¼š
- [ ] é¦–æ¬¡ç¿»è¯‘å“åº”æ—¶é—´ < 2ç§’
- [ ] ç¼“å­˜å‘½ä¸­åå“åº”æ—¶é—´ < 100ms
- [ ] UIæ¸²æŸ“æ—¶é—´ < 50ms
- [ ] éŸ³é¢‘æ’­æ”¾å»¶è¿Ÿ < 500ms
- [ ] å†…å­˜å ç”¨ < 50MB

## ğŸ› å·²çŸ¥é—®é¢˜

è®°å½•åœ¨æ­¤ï¼š

1. 

## ğŸ’¡ æœªæ¥æ”¹è¿›

- [ ] æ·»åŠ æ›´å¤šç¿»è¯‘æä¾›å•†ï¼ˆç™¾åº¦ã€DeepLç­‰ï¼‰
- [ ] æ”¯æŒç¦»çº¿è¯å…¸ï¼ˆå¤§å‹è¯åº“ï¼‰
- [ ] æ·»åŠ ç¿»è¯‘å†å²è®°å½•
- [ ] æ”¯æŒå¯¼å‡ºç¿»è¯‘å†å²
- [ ] æ·»åŠ å•è¯æœ¬åŠŸèƒ½
- [ ] æ”¯æŒè‡ªå®šä¹‰å¿«æ·é”®
- [ ] æ·»åŠ åˆ’è¯ç¿»è¯‘åŠŸèƒ½
- [ ] ä¼˜åŒ–éŸ³é¢‘è´¨é‡
- [ ] æ”¯æŒè¯­éŸ³è¾“å…¥
- [ ] æ·»åŠ OCRå›¾ç‰‡ç¿»è¯‘

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è„šæœ¬åŠ è½½é¡ºåºå¾ˆé‡è¦**ï¼štranslation-service.js å¿…é¡»åœ¨ translation-ui.js ä¹‹å‰åŠ è½½
2. **ç¼“å­˜ç­–ç•¥**ï¼šé»˜è®¤ç¼“å­˜100æ¡ç»“æœï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´
3. **éŸ³é¢‘æ’­æ”¾**ï¼šæŸäº›ç½‘ç«™å¯èƒ½é˜»æ­¢è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘
4. **APIé™åˆ¶**ï¼šGoogle Translate å…¬å…±APIæœ‰è¯·æ±‚é™åˆ¶ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨å®˜æ–¹API
5. **éšç§ä¿æŠ¤**ï¼šä¸è¦ç¿»è¯‘å¯†ç ã€é‚®ç®±ç­‰æ•æ„Ÿä¿¡æ¯
6. **æ€§èƒ½è€ƒè™‘**ï¼šæ‰¹é‡ç¿»è¯‘æ—¶æ·»åŠ é€‚å½“å»¶è¿Ÿ
7. **é”™è¯¯å¤„ç†**ï¼šå§‹ç»ˆæä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

## ğŸ¯ æœ¬å‘¨ç›®æ ‡

- [ ] å®Œæˆé˜¶æ®µ1ï¼ˆé›†æˆåˆ°ç°æœ‰ä»£ç ï¼‰
- [ ] å®Œæˆé˜¶æ®µ2ï¼ˆæµ‹è¯•ä¸ä¼˜åŒ–ï¼‰
- [ ] å®Œæˆé˜¶æ®µ3ï¼ˆæ–‡æ¡£ä¸å‘å¸ƒï¼‰

---

**å¼€å§‹é›†æˆå§ï¼** æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ä¸€æ­¥æ­¥æ¥ï¼Œé‡åˆ°é—®é¢˜éšæ—¶æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚åŠ æ²¹ï¼ğŸ’ª
