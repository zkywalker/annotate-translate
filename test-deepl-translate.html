<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeepL Translation Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      padding: 40px;
      max-width: 1200px;
      margin: 0 auto;
      line-height: 1.6;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 2.5em;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .section {
      margin-bottom: 30px;
      padding: 25px;
      border-radius: 8px;
      background: #f7fafc;
      border: 1px solid #e2e8f0;
    }

    .section h2 {
      color: #2d3748;
      margin-bottom: 15px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section h2::before {
      content: "üîß";
    }

    .config-section h2::before {
      content: "‚öôÔ∏è";
    }

    .test-section h2::before {
      content: "üß™";
    }

    .result-section h2::before {
      content: "üìä";
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #4a5568;
      font-weight: 600;
    }

    input[type="text"],
    input[type="password"],
    textarea,
    select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .button-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-secondary {
      background: #48bb78;
      color: white;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-info {
      background: #4299e1;
      color: white;
    }

    .result-box {
      background: white;
      padding: 20px;
      border-radius: 6px;
      border: 2px solid #e2e8f0;
      margin-top: 15px;
    }

    .result-box h3 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .result-item {
      margin-bottom: 15px;
      padding: 12px;
      background: #f7fafc;
      border-radius: 4px;
      border-left: 4px solid #667eea;
    }

    .result-label {
      color: #718096;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.9em;
    }

    .result-value {
      color: #2d3748;
      font-size: 1.1em;
    }

    .phonetic {
      color: #e53e3e;
      font-style: italic;
    }

    .definition {
      margin-bottom: 8px;
      padding-left: 15px;
      border-left: 3px solid #667eea;
    }

    .part-of-speech {
      color: #805ad5;
      font-weight: 600;
      margin-right: 8px;
    }

    .example {
      background: #ebf8ff;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 8px;
      border-left: 3px solid #4299e1;
    }

    .example-source {
      color: #2c5282;
      margin-bottom: 4px;
    }

    .example-translation {
      color: #2d5a7b;
      font-style: italic;
    }

    .status {
      padding: 10px 15px;
      border-radius: 6px;
      margin-top: 15px;
      font-weight: 500;
    }

    .status.success {
      background: #c6f6d5;
      color: #22543d;
      border: 1px solid #9ae6b4;
    }

    .status.error {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #fc8181;
    }

    .status.info {
      background: #bee3f8;
      color: #2c5282;
      border: 1px solid #90cdf4;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      cursor: pointer;
    }

    .info-box {
      background: #ebf8ff;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #4299e1;
      margin-bottom: 20px;
    }

    .info-box strong {
      color: #2c5282;
    }

    .provider-badge {
      display: inline-block;
      padding: 4px 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 600;
    }

    code {
      background: #2d3748;
      color: #68d391;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .test-examples {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .test-example {
      padding: 12px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .test-example:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .test-example strong {
      display: block;
      color: #2d3748;
      margin-bottom: 5px;
    }

    .test-example span {
      color: #718096;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåê DeepL Translation Test</h1>
    <p class="subtitle">Test the DeepL translation service provider implementation</p>

    <!-- Configuration Section -->
    <div class="section config-section">
      <h2>API Configuration</h2>
      
      <div class="info-box">
        <strong>üìù Note:</strong> You need a DeepL API key to use this service.
        <br>Get your free API key at: <a href="https://www.deepl.com/pro-api" target="_blank">https://www.deepl.com/pro-api</a>
        <br>Free tier includes 500,000 characters/month.
        <br><br>
        <strong>üîë API Key Types:</strong>
        <br>‚Ä¢ <strong>Free API keys</strong> end with <code>:fx</code> ‚Üí Use Free API ‚úÖ
        <br>‚Ä¢ <strong>Pro API keys</strong> have no <code>:fx</code> suffix ‚Üí Uncheck Free API ‚ùå
        <br><br>
        <strong>‚ö° Auto-Detection:</strong> The extension will automatically detect your key type if it ends with <code>:fx</code>
      </div>

      <div class="form-group">
        <label for="apiKey">DeepL API Key:</label>
        <input type="password" id="apiKey" placeholder="Enter your DeepL API key">
      </div>

      <div class="checkbox-group">
        <input type="checkbox" id="useFreeApi" checked>
        <label for="useFreeApi">Use Free API (api-free.deepl.com)</label>
      </div>

      <div class="button-group">
        <button class="btn-secondary" onclick="saveConfig()">
          üíæ Save Configuration
        </button>
        <button class="btn-info" onclick="testConnection()">
          üîå Test Connection
        </button>
      </div>

      <div id="configStatus"></div>
    </div>

    <!-- Translation Test Section -->
    <div class="section test-section">
      <h2>Translation Test</h2>

      <div class="form-group">
        <label for="sourceText">Source Text:</label>
        <textarea id="sourceText" placeholder="Enter text to translate...">Hello, world! How are you today?</textarea>
      </div>

      <div class="form-group">
        <label for="sourceLang">Source Language:</label>
        <select id="sourceLang">
          <option value="auto">Auto Detect</option>
          <option value="en" selected>English</option>
          <option value="zh-CN">Chinese (Simplified)</option>
          <option value="ja">Japanese</option>
          <option value="ko">Korean</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="es">Spanish</option>
          <option value="ru">Russian</option>
        </select>
      </div>

      <div class="form-group">
        <label for="targetLang">Target Language:</label>
        <select id="targetLang">
          <option value="zh-CN" selected>Chinese (Simplified)</option>
          <option value="en">English</option>
          <option value="ja">Japanese</option>
          <option value="ko">Korean</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="es">Spanish</option>
          <option value="ru">Russian</option>
        </select>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="testTranslation()">
          üöÄ Translate
        </button>
        <button class="btn-danger" onclick="clearResults()">
          üóëÔ∏è Clear Results
        </button>
      </div>

      <div class="test-examples">
        <div class="test-example" onclick="loadExample('hello', 'en', 'zh-CN')">
          <strong>English ‚Üí Chinese</strong>
          <span>"Hello, how are you?"</span>
        </div>
        <div class="test-example" onclick="loadExample('bonjour', 'fr', 'en')">
          <strong>French ‚Üí English</strong>
          <span>"Bonjour le monde!"</span>
        </div>
        <div class="test-example" onclick="loadExample('hallo', 'de', 'zh-CN')">
          <strong>German ‚Üí Chinese</strong>
          <span>"Guten Tag!"</span>
        </div>
        <div class="test-example" onclick="loadExample('tech', 'en', 'zh-CN')">
          <strong>Tech Text</strong>
          <span>"AI and machine learning"</span>
        </div>
      </div>

      <div id="testStatus"></div>
    </div>

    <!-- Results Section -->
    <div class="section result-section">
      <h2>Translation Results</h2>
      <div id="results"></div>
    </div>
  </div>

  <script>
    // Example texts
    const examples = {
      hello: "Hello, how are you today?",
      bonjour: "Bonjour le monde!",
      hallo: "Guten Tag!",
      tech: "Artificial intelligence and machine learning are transforming our world."
    };

    // Load configuration from localStorage
    function loadConfig() {
      const apiKey = localStorage.getItem('deepl_api_key') || '';
      const useFreeApi = localStorage.getItem('deepl_use_free_api') !== 'false';
      
      document.getElementById('apiKey').value = apiKey;
      document.getElementById('useFreeApi').checked = useFreeApi;
    }

    // Save configuration to localStorage
    function saveConfig() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const useFreeApi = document.getElementById('useFreeApi').checked;
      
      if (!apiKey) {
        showStatus('configStatus', 'error', '‚ùå Please enter an API key');
        return;
      }
      
      localStorage.setItem('deepl_api_key', apiKey);
      localStorage.setItem('deepl_use_free_api', useFreeApi);
      
      showStatus('configStatus', 'success', '‚úÖ Configuration saved successfully!');
      
      // Update the provider configuration
      updateProviderConfig();
    }

    // Update provider configuration
    function updateProviderConfig() {
      const apiKey = localStorage.getItem('deepl_api_key') || '';
      const useFreeApi = localStorage.getItem('deepl_use_free_api') !== 'false';
      
      if (typeof translationService !== 'undefined') {
        const provider = translationService.getProvider('deepl');
        if (provider) {
          provider.updateConfig(apiKey, useFreeApi);
          console.log('[Test] DeepL provider configured');
        }
      }
    }

    // Test API connection
    async function testConnection() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const useFreeApi = document.getElementById('useFreeApi').checked;
      
      if (!apiKey) {
        showStatus('configStatus', 'error', '‚ùå Please enter an API key first');
        return;
      }
      
      showStatus('configStatus', 'info', '‚è≥ Testing connection...');
      
      try {
        // Save config first
        localStorage.setItem('deepl_api_key', apiKey);
        localStorage.setItem('deepl_use_free_api', useFreeApi);
        updateProviderConfig();
        
        // Test with a simple translation
        if (typeof translationService === 'undefined') {
          throw new Error('Translation service not loaded');
        }
        
        translationService.setActiveProvider('deepl');
        const result = await translationService.translate('Hello', 'zh-CN', 'en');
        
        showStatus('configStatus', 'success', `‚úÖ Connection successful! Test translation: "${result.translatedText}"`);
      } catch (error) {
        console.error('[Test] Connection test failed:', error);
        showStatus('configStatus', 'error', `‚ùå Connection failed: ${error.message}`);
      }
    }

    // Test translation
    async function testTranslation() {
      const sourceText = document.getElementById('sourceText').value.trim();
      const sourceLang = document.getElementById('sourceLang').value;
      const targetLang = document.getElementById('targetLang').value;
      
      if (!sourceText) {
        showStatus('testStatus', 'error', '‚ùå Please enter text to translate');
        return;
      }
      
      const apiKey = localStorage.getItem('deepl_api_key');
      if (!apiKey) {
        showStatus('testStatus', 'error', '‚ùå Please configure API key first');
        return;
      }
      
      showStatus('testStatus', 'info', '‚è≥ Translating...');
      
      try {
        // Ensure provider is configured
        updateProviderConfig();
        
        if (typeof translationService === 'undefined') {
          throw new Error('Translation service not loaded');
        }
        
        translationService.setActiveProvider('deepl');
        
        const startTime = Date.now();
        const result = await translationService.translate(sourceText, targetLang, sourceLang);
        const endTime = Date.now();
        
        showStatus('testStatus', 'success', `‚úÖ Translation completed in ${endTime - startTime}ms`);
        displayResults(result);
      } catch (error) {
        console.error('[Test] Translation failed:', error);
        showStatus('testStatus', 'error', `‚ùå Translation failed: ${error.message}`);
      }
    }

    // Display translation results
    function displayResults(result) {
      const resultsDiv = document.getElementById('results');
      
      const html = `
        <div class="result-box">
          <h3>Translation Result <span class="provider-badge">${result.provider}</span></h3>
          
          <div class="result-item">
            <div class="result-label">Original Text:</div>
            <div class="result-value">${escapeHtml(result.originalText)}</div>
          </div>
          
          <div class="result-item">
            <div class="result-label">Translated Text:</div>
            <div class="result-value">${escapeHtml(result.translatedText)}</div>
          </div>
          
          <div class="result-item">
            <div class="result-label">Languages:</div>
            <div class="result-value">${result.sourceLang} ‚Üí ${result.targetLang}</div>
          </div>
          
          ${result.phonetics && result.phonetics.length > 0 ? `
            <div class="result-item">
              <div class="result-label">Phonetics:</div>
              ${result.phonetics.map(p => `
                <div class="phonetic">${escapeHtml(p.text)} ${p.type ? `(${p.type})` : ''}</div>
              `).join('')}
            </div>
          ` : '<div class="result-item"><div class="result-label">Phonetics:</div><div class="result-value">No phonetics available (will be supplemented if enabled)</div></div>'}
          
          ${result.definitions && result.definitions.length > 0 ? `
            <div class="result-item">
              <div class="result-label">Definitions:</div>
              ${result.definitions.map(d => `
                <div class="definition">
                  <span class="part-of-speech">${escapeHtml(d.partOfSpeech)}</span>
                  ${escapeHtml(d.text)}
                </div>
              `).join('')}
            </div>
          ` : '<div class="result-item"><div class="result-label">Definitions:</div><div class="result-value">No definitions available</div></div>'}
          
          ${result.examples && result.examples.length > 0 ? `
            <div class="result-item">
              <div class="result-label">Examples:</div>
              ${result.examples.map(e => `
                <div class="example">
                  <div class="example-source">${escapeHtml(e.source)}</div>
                  ${e.translation ? `<div class="example-translation">${escapeHtml(e.translation)}</div>` : ''}
                </div>
              `).join('')}
            </div>
          ` : ''}
          
          <div class="result-item">
            <div class="result-label">Annotation Text:</div>
            <div class="result-value">${escapeHtml(result.annotationText || result.translatedText)}</div>
          </div>
          
          <div class="result-item">
            <div class="result-label">Timestamp:</div>
            <div class="result-value">${new Date(result.timestamp).toLocaleString()}</div>
          </div>
        </div>
      `;
      
      resultsDiv.innerHTML = html;
    }

    // Load example
    function loadExample(key, source, target) {
      document.getElementById('sourceText').value = examples[key];
      document.getElementById('sourceLang').value = source;
      document.getElementById('targetLang').value = target;
      showStatus('testStatus', 'info', `üìù Example loaded: ${key}`);
    }

    // Clear results
    function clearResults() {
      document.getElementById('results').innerHTML = '<div class="info-box">No translation results yet. Run a translation test to see results here.</div>';
      showStatus('testStatus', 'info', 'üóëÔ∏è Results cleared');
    }

    // Show status message
    function showStatus(elementId, type, message) {
      const statusDiv = document.getElementById(elementId);
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadConfig();
      clearResults();
      
      // Load translation service
      const script = document.createElement('script');
      script.src = 'translation-service.js';
      script.onload = () => {
        console.log('[Test] Translation service loaded');
        updateProviderConfig();
      };
      document.head.appendChild(script);
    });
  </script>
</body>
</html>
