<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Translation Service Test</title>
  <link rel="stylesheet" href="translation-ui.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    .test-panel {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      margin-bottom: 30px;
    }

    .test-section {
      margin-bottom: 30px;
    }

    .test-section:last-child {
      margin-bottom: 0;
    }

    .test-section h2 {
      font-size: 20px;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .test-section h2::before {
      content: '';
      width: 4px;
      height: 20px;
      background: #667eea;
      border-radius: 2px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #555;
      margin-bottom: 5px;
    }

    .input-group input,
    .input-group select,
    .input-group textarea {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .input-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-warning {
      background: #ffc107;
      color: #333;
    }

    .btn-warning:hover {
      background: #e0a800;
    }

    .results-container {
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      min-height: 100px;
    }

    .results-container.empty {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-style: italic;
    }

    .log-container {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }

    .log-entry {
      margin-bottom: 5px;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .log-entry.error {
      color: #f48771;
    }

    .log-entry.success {
      color: #89d185;
    }

    .log-entry.info {
      color: #4fc1ff;
    }

    .provider-status {
      display: flex;
      gap: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .provider-item {
      flex: 1;
      padding: 10px;
      background: white;
      border-radius: 4px;
      text-align: center;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
    }

    .provider-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .provider-item.active {
      border-color: #667eea;
      background: #f0f3ff;
    }

    .provider-item .name {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .provider-item .status {
      font-size: 12px;
      color: #28a745;
    }

    .divider {
      height: 1px;
      background: #e0e0e0;
      margin: 30px 0;
    }

    /* Âä†ËΩΩÂä®Áîª */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ÂìçÂ∫îÂºè */
    @media (max-width: 768px) {
      .provider-status {
        flex-direction: column;
      }

      .button-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üåê Translation Service Test</h1>
      <p>Test the translation service abstraction layer</p>
    </div>

    <div class="test-panel">
      <!-- Provider Status -->
      <div class="test-section">
        <h2>Translation Providers</h2>
        <div class="provider-status" id="providerStatus">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>

      <div class="divider"></div>

      <!-- Basic Translation Test -->
      <div class="test-section">
        <h2>Basic Translation</h2>
        <div class="input-group">
          <label for="inputText">Text to translate:</label>
          <textarea id="inputText" placeholder="Enter text to translate...">Hello world</textarea>
        </div>
        <div class="input-group">
          <label for="sourceLang">Source Language:</label>
          <select id="sourceLang">
            <option value="auto">Auto Detect</option>
            <option value="en">English</option>
            <option value="zh-CN">Chinese (Simplified)</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
          </select>
        </div>
        <div class="input-group">
          <label for="targetLang">Target Language:</label>
          <select id="targetLang">
            <option value="zh-CN">Chinese (Simplified)</option>
            <option value="en">English</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
          </select>
        </div>
        <div class="button-group">
          <button class="btn btn-primary" onclick="testBasicTranslation()">Translate</button>
          <button class="btn btn-secondary" onclick="clearResults()">Clear</button>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Quick Tests -->
      <div class="test-section">
        <h2>Quick Tests</h2>
        <div class="button-group">
          <button class="btn btn-success" onclick="testWord()">Test Word (apple)</button>
          <button class="btn btn-success" onclick="testSentence()">Test Sentence</button>
          <button class="btn btn-success" onclick="testParagraph()">Test Paragraph</button>
          <button class="btn btn-warning" onclick="testAllProviders()">Test All Providers</button>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Results -->
      <div class="test-section">
        <h2>Translation Results</h2>
        <div class="results-container empty" id="results">
          No translation yet. Click "Translate" to see results.
        </div>
      </div>

      <div class="divider"></div>

      <!-- Console Log -->
      <div class="test-section">
        <h2>Console Log</h2>
        <div class="log-container" id="logContainer">
          <div class="log-entry info">[INFO] Translation service initialized</div>
        </div>
        <div class="button-group" style="margin-top: 10px;">
          <button class="btn btn-secondary" onclick="clearLog()">Clear Log</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="translation-service.js"></script>
  <script src="translation-ui.js"></script>
  <script>
    // Log function
    function log(message, type = 'info') {
      const logContainer = document.getElementById('logContainer');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function clearLog() {
      const logContainer = document.getElementById('logContainer');
      logContainer.innerHTML = '<div class="log-entry info">[INFO] Log cleared</div>';
    }

    // Initialize provider status
    function updateProviderStatus() {
      const statusContainer = document.getElementById('providerStatus');
      statusContainer.innerHTML = '';

      translationService.providers.forEach((provider, name) => {
        const item = document.createElement('div');
        item.className = 'provider-item';
        if (name === translationService.activeProvider) {
          item.classList.add('active');
        }
        item.innerHTML = `
          <div class="name">${provider.name}</div>
          <div class="status">‚úì Ready</div>
        `;
        item.onclick = () => {
          translationService.setActiveProvider(name);
          updateProviderStatus();
          log(`Switched to provider: ${provider.name}`, 'success');
        };
        statusContainer.appendChild(item);
      });
    }

    // Clear results
    function clearResults() {
      const resultsContainer = document.getElementById('results');
      resultsContainer.className = 'results-container empty';
      resultsContainer.innerHTML = 'No translation yet. Click "Translate" to see results.';
      log('Results cleared', 'info');
    }

    // Basic translation test
    async function testBasicTranslation() {
      const text = document.getElementById('inputText').value.trim();
      const sourceLang = document.getElementById('sourceLang').value;
      const targetLang = document.getElementById('targetLang').value;

      if (!text) {
        log('Please enter text to translate', 'error');
        return;
      }

      log(`Translating "${text}" from ${sourceLang} to ${targetLang}...`, 'info');

      try {
        const result = await translationService.translate(text, targetLang, sourceLang);
        log(`Translation successful: "${result.translatedText}"`, 'success');
        
        // Render UI
        renderResult(result);
      } catch (error) {
        log(`Translation failed: ${error.message}`, 'error');
      }
    }

    // Render translation result
    function renderResult(result) {
      const resultsContainer = document.getElementById('results');
      resultsContainer.className = 'results-container';
      resultsContainer.innerHTML = '';

      const ui = new TranslationUI({
        showPhonetics: true,
        showDefinitions: true,
        showExamples: true,
        maxExamples: 3,
        enableAudio: true
      });

      const element = result.originalText.length > 50 
        ? ui.renderSimple(result)
        : ui.render(result);
      
      resultsContainer.appendChild(element);

      // Also show JSON
      const jsonPre = document.createElement('pre');
      jsonPre.style.cssText = 'margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 6px; font-size: 12px; overflow-x: auto;';
      jsonPre.textContent = JSON.stringify(result, null, 2);
      resultsContainer.appendChild(jsonPre);
    }

    // Quick test functions
    async function testWord() {
      document.getElementById('inputText').value = 'apple';
      document.getElementById('sourceLang').value = 'en';
      document.getElementById('targetLang').value = 'zh-CN';
      await testBasicTranslation();
    }

    async function testSentence() {
      document.getElementById('inputText').value = 'The quick brown fox jumps over the lazy dog.';
      document.getElementById('sourceLang').value = 'en';
      document.getElementById('targetLang').value = 'zh-CN';
      await testBasicTranslation();
    }

    async function testParagraph() {
      document.getElementById('inputText').value = 'Machine translation is the task of automatically converting text from one natural language to another. It has been one of the most important applications of natural language processing.';
      document.getElementById('sourceLang').value = 'en';
      document.getElementById('targetLang').value = 'zh-CN';
      await testBasicTranslation();
    }

    async function testAllProviders() {
      const text = 'hello';
      const targetLang = 'zh-CN';
      const providers = ['google', 'youdao', 'local'];

      log('Testing all providers...', 'info');

      for (const provider of providers) {
        try {
          translationService.setActiveProvider(provider);
          updateProviderStatus();
          
          log(`Testing ${provider}...`, 'info');
          const result = await translationService.translate(text, targetLang);
          log(`${provider}: "${result.translatedText}" ‚úì`, 'success');
        } catch (error) {
          log(`${provider}: ${error.message} ‚úó`, 'error');
        }
      }

      log('All providers tested', 'info');
    }

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      updateProviderStatus();
      log('Page loaded and ready', 'success');
    });

    // Override console methods to also log to our log container
    const originalConsoleLog = console.log;
    const originalConsoleError = console.error;

    console.log = function(...args) {
      originalConsoleLog.apply(console, args);
      log(args.join(' '), 'info');
    };

    console.error = function(...args) {
      originalConsoleError.apply(console, args);
      log(args.join(' '), 'error');
    };
  </script>
</body>
</html>
