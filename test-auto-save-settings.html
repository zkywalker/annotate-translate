<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>测试：设置自动保存与弹窗编辑</title>
  <script src="lucide.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 40px;
      font-size: 16px;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }

    .feature-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 30px;
      border-left: 4px solid #667eea;
    }

    .feature-card h2 {
      color: #667eea;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      padding: 10px 0;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      line-height: 1.6;
    }

    .feature-list li::before {
      content: '✓';
      color: #28a745;
      font-weight: bold;
      font-size: 18px;
      flex-shrink: 0;
    }

    .demo-section {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid #e0e0e0;
    }

    .demo-section h3 {
      color: #555;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .demo-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .demo-control {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .demo-control label {
      display: block;
      font-weight: 500;
      color: #555;
      margin-bottom: 10px;
    }

    .demo-control input[type="checkbox"] {
      margin-right: 8px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .demo-control input[type="text"],
    .demo-control input[type="number"] {
      width: 100%;
      padding: 10px 40px 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      background: #f8f9fa;
      cursor: pointer;
    }

    .demo-control input[readonly]:hover {
      border-color: #667eea;
    }

    .input-wrapper {
      position: relative;
    }

    .edit-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #667eea;
      cursor: pointer;
      transition: all 0.2s;
    }

    .edit-icon:hover {
      color: #5568d3;
      transform: translateY(-50%) scale(1.1);
    }

    .auto-save-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      pointer-events: none;
      z-index: 10000;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    .auto-save-indicator.show {
      opacity: 1;
      transform: translateY(0);
    }

    .auto-save-indicator::before {
      content: '✓';
      font-size: 18px;
      font-weight: bold;
    }

    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .comparison-table th,
    .comparison-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    .comparison-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #555;
    }

    .comparison-table tbody tr:hover {
      background: #f8f9fa;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .badge-before {
      background: #f8d7da;
      color: #721c24;
    }

    .badge-after {
      background: #d4edda;
      color: #155724;
    }

    .highlight-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 20px;
      border-radius: 6px;
      margin: 20px 0;
    }

    .highlight-box strong {
      color: #856404;
    }

    .code-example {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      margin: 15px 0;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    @media (max-width: 768px) {
      .feature-grid {
        grid-template-columns: 1fr;
      }

      .demo-controls {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>⚡ 设置页面优化：即时保存 + 弹窗编辑</h1>
    <p class="subtitle">解决"保存按钮太远容易忘记点击"的 UX 问题</p>

    <!-- 核心功能介绍 -->
    <div class="feature-grid">
      <div class="feature-card">
        <h2>
          <i data-lucide="zap" width="24" height="24"></i>
          即时自动保存
        </h2>
        <ul class="feature-list">
          <li>复选框：勾选/取消勾选后立即保存</li>
          <li>单选框：选择翻译提供商后立即保存</li>
          <li>下拉框：切换语言后立即保存</li>
          <li>无需手动点击"保存"按钮</li>
          <li>右上角显示"已自动保存"提示</li>
        </ul>
      </div>

      <div class="feature-card">
        <h2>
          <i data-lucide="edit-3" width="24" height="24"></i>
          弹窗编辑输入框
        </h2>
        <ul class="feature-list">
          <li>数字输入框：点击弹窗编辑</li>
          <li>文本输入框：点击弹窗输入 API Key</li>
          <li>输入框显示编辑图标提示</li>
          <li>弹窗带范围验证和提示</li>
          <li>保存后立即自动保存</li>
        </ul>
      </div>

      <div class="feature-card">
        <h2>
          <i data-lucide="shield-check" width="24" height="24"></i>
          安全与便利兼顾
        </h2>
        <ul class="feature-list">
          <li>输入框只读模式防止误操作</li>
          <li>弹窗确认机制避免错误输入</li>
          <li>密码字段加密显示</li>
          <li>保留"手动保存全部"按钮</li>
          <li>所有更改本地存储</li>
        </ul>
      </div>
    </div>

    <!-- 使用体验对比 -->
    <div class="demo-section">
      <h3>
        <i data-lucide="git-compare" width="24" height="24"></i>
        使用体验对比
      </h3>
      <table class="comparison-table">
        <thead>
          <tr>
            <th>场景</th>
            <th><span class="badge badge-before">修改前</span> 旧流程</th>
            <th><span class="badge badge-after">修改后</span> 新流程</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>切换翻译提供商</strong></td>
            <td>
              1. 选择提供商<br>
              2. 滚动到页面底部<br>
              3. 点击"保存设置"<br>
              <span style="color: #dc3545;">❌ 容易忘记保存</span>
            </td>
            <td>
              1. 选择提供商<br>
              2. 自动保存完成！<br>
              <br>
              <span style="color: #28a745;">✓ 无需额外操作</span>
            </td>
          </tr>
          <tr>
            <td><strong>开启/关闭功能</strong></td>
            <td>
              1. 勾选复选框<br>
              2. 继续修改其他设置<br>
              3. 记得保存（容易遗忘）<br>
              <span style="color: #dc3545;">❌ 多步操作</span>
            </td>
            <td>
              1. 勾选复选框<br>
              2. 立即生效！<br>
              <br>
              <span style="color: #28a745;">✓ 即改即存</span>
            </td>
          </tr>
          <tr>
            <td><strong>修改 API Key</strong></td>
            <td>
              1. 在输入框输入<br>
              2. 容易误操作粘贴错误<br>
              3. 滚动保存<br>
              <span style="color: #dc3545;">❌ 不够安全</span>
            </td>
            <td>
              1. 点击编辑图标<br>
              2. 弹窗中输入/粘贴<br>
              3. 确认后自动保存<br>
              <span style="color: #28a745;">✓ 安全可控</span>
            </td>
          </tr>
          <tr>
            <td><strong>调整数字设置</strong></td>
            <td>
              1. 输入数字<br>
              2. 可能超出范围<br>
              3. 手动保存<br>
              <span style="color: #dc3545;">❌ 缺少验证</span>
            </td>
            <td>
              1. 点击编辑图标<br>
              2. 弹窗显示范围提示<br>
              3. 自动验证+保存<br>
              <span style="color: #28a745;">✓ 智能验证</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 交互演示 -->
    <div class="demo-section">
      <h3>
        <i data-lucide="play-circle" width="24" height="24"></i>
        功能演示
      </h3>

      <div class="demo-controls">
        <div class="demo-control">
          <label>
            <input type="checkbox" id="demoCheckbox" checked>
            启用自动翻译
          </label>
          <p style="font-size: 12px; color: #666; margin-top: 8px;">
            ✓ 点击后立即自动保存
          </p>
        </div>

        <div class="demo-control">
          <label>最大示例数量</label>
          <div class="input-wrapper">
            <input type="number" id="demoNumber" value="3" readonly>
            <i data-lucide="edit-3" width="20" height="20" class="edit-icon"></i>
          </div>
          <p style="font-size: 12px; color: #666; margin-top: 8px;">
            ✓ 点击输入框或编辑图标打开弹窗
          </p>
        </div>

        <div class="demo-control">
          <label>API Key</label>
          <div class="input-wrapper">
            <input type="text" id="demoText" value="your-api-key-here" readonly>
            <i data-lucide="edit-3" width="20" height="20" class="edit-icon"></i>
          </div>
          <p style="font-size: 12px; color: #666; margin-top: 8px;">
            ✓ 弹窗编辑，安全输入
          </p>
        </div>
      </div>

      <div class="highlight-box" style="margin-top: 30px;">
        <strong>💡 提示：</strong> 
        点击上方的复选框或输入框编辑图标，体验新的交互方式！
      </div>
    </div>

    <!-- 技术实现 -->
    <div class="demo-section">
      <h3>
        <i data-lucide="code" width="24" height="24"></i>
        技术实现要点
      </h3>

      <h4 style="color: #667eea; margin: 20px 0 10px;">1. 自动保存函数</h4>
      <div class="code-example">function autoSaveSettings() {
  const settings = {
    enableTranslate: elements.enableTranslate.checked,
    translationProvider: document.querySelector('input[name="provider"]:checked').value,
    targetLanguage: elements.targetLanguage.value,
    // ... 其他设置
  };
  
  chrome.storage.sync.set(settings, () => {
    console.log('[Options] Settings auto-saved');
    showAutoSaveIndicator(); // 显示提示
  });
}</div>

      <h4 style="color: #667eea; margin: 20px 0 10px;">2. 为控件添加自动保存监听</h4>
      <div class="code-example">// 复选框自动保存
const autoSaveCheckboxes = ['enableTranslate', 'enableAnnotate', ...];
autoSaveCheckboxes.forEach(id => {
  document.getElementById(id).addEventListener('change', autoSaveSettings);
});

// 单选框自动保存
document.querySelectorAll('input[name="provider"]').forEach(radio => {
  radio.addEventListener('change', autoSaveSettings);
});

// 下拉框自动保存
elements.uiLanguage.addEventListener('change', autoSaveSettings);</div>

      <h4 style="color: #667eea; margin: 20px 0 10px;">3. 弹窗编辑数字输入</h4>
      <div class="code-example">elements.maxExamples.readOnly = true; // 设为只读
elements.maxExamples.style.cursor = 'pointer'; // 鼠标变手型

elements.maxExamples.addEventListener('click', () => {
  showNumberInputDialog({
    title: '最大示例数量',
    label: '设置要显示的例句数量',
    currentValue: parseInt(elements.maxExamples.value, 10),
    min: 1,
    max: 10,
    unit: '条',
    onSave: (value) => {
      elements.maxExamples.value = value;
      autoSaveSettings(); // 保存后自动保存
    }
  });
});</div>
    </div>

    <!-- 优势总结 -->
    <div class="demo-section" style="background: linear-gradient(135deg, #e7f3ff 0%, #f0e7ff 100%);">
      <h3>
        <i data-lucide="trophy" width="24" height="24"></i>
        用户体验提升
      </h3>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
        <div style="background: white; padding: 20px; border-radius: 8px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">⚡ 减少操作步骤</h4>
          <p style="color: #666; line-height: 1.6;">
            大部分设置从 <strong>3步</strong>（修改→滚动→保存）简化为 <strong>1步</strong>（修改即保存）
          </p>
        </div>

        <div style="background: white; padding: 20px; border-radius: 8px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">🛡️ 防止遗忘保存</h4>
          <p style="color: #666; line-height: 1.6;">
            自动保存机制，用户无需记住点击保存按钮，避免修改丢失
          </p>
        </div>

        <div style="background: white; padding: 20px; border-radius: 8px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">✨ 即时反馈</h4>
          <p style="color: #666; line-height: 1.6;">
            右上角"已自动保存"提示，让用户清楚知道设置已生效
          </p>
        </div>

        <div style="background: white; padding: 20px; border-radius: 8px;">
          <h4 style="color: #667eea; margin-bottom: 10px;">🔒 更加安全</h4>
          <p style="color: #666; line-height: 1.6;">
            输入框通过弹窗编辑，避免误操作，并带范围验证提示
          </p>
        </div>
      </div>
    </div>

    <!-- 相关文件 -->
    <div class="demo-section">
      <h3>
        <i data-lucide="file-code" width="24" height="24"></i>
        修改的文件
      </h3>
      <ul class="feature-list" style="margin-top: 15px;">
        <li><strong>options.js</strong> - 添加 autoSaveSettings()、showNumberInputDialog()、showTextInputDialog() 函数</li>
        <li><strong>options.html</strong> - 添加弹窗样式、自动保存提示样式、更新按钮文案</li>
        <li><strong>效果</strong> - 复选框/单选框/下拉框立即保存，输入框弹窗编辑</li>
      </ul>

      <div style="margin-top: 20px; padding: 20px; background: #d4edda; border-radius: 8px; border-left: 4px solid #28a745;">
        <strong style="color: #155724;">✅ 改进完成</strong><br>
        <span style="color: #155724;">
          新的设置页面交互更符合现代 Web 应用的 UX 标准，减少用户认知负担，提升使用流畅度！
        </span>
      </div>
    </div>
  </div>

  <!-- 自动保存提示 -->
  <div class="auto-save-indicator" id="autoSaveIndicator">已自动保存</div>

  <script>
    // 初始化 Lucide 图标
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }

    // 演示：复选框自动保存
    document.getElementById('demoCheckbox').addEventListener('change', function() {
      showAutoSave();
      console.log('复选框状态已保存:', this.checked);
    });

    // 演示：显示自动保存提示
    function showAutoSave() {
      const indicator = document.getElementById('autoSaveIndicator');
      indicator.classList.add('show');
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 2000);
    }

    // 演示：点击输入框显示提示（实际项目中会打开弹窗）
    document.getElementById('demoNumber').addEventListener('click', function() {
      alert('在实际应用中，这里会打开一个弹窗编辑数字\n\n弹窗特性：\n✓ 范围验证 (1-10)\n✓ 单位提示 (条)\n✓ 确认后自动保存');
    });

    document.getElementById('demoText').addEventListener('click', function() {
      alert('在实际应用中，这里会打开一个弹窗编辑文本\n\n弹窗特性：\n✓ 密码字段加密显示\n✓ 输入提示\n✓ 确认后自动保存');
    });

    // 演示：点击编辑图标
    document.querySelectorAll('.edit-icon').forEach(icon => {
      icon.addEventListener('click', function(e) {
        e.stopPropagation();
        const input = this.previousElementSibling;
        input.click();
      });
    });
  </script>
</body>
</html>
